---
title: 指南页面的自动收集
id: 2019050401
date: 2019-05-04 01:45:06
updated: 2019-05-05 01:45:06
categories: 建站
tags: [guide,Shell]
keywords: guide,Shell
---


最近给博客站点增加了一个独立的页面：**指南**，用来记录本站点的所有文章，包括发表时间与文章链接，并按照发表时间倒序排列，仅供快速查找以及核对使用。其中，还会有一个文章编号，就是 url 的数字部分，由日期与编号组成，例如2019050201表示2019年05月02日发表的第1篇文章，这个文章编号对我来说很有用，用来核对查重。但是，为了简化这个页面的整理工作以及后续的自动生成，我需要把这个流程自动化，本文记录实现思路与实现方式。


<!-- more -->


# 实现思路


为了简化难度，我准备使用 Shell 解决这个问题。大概思路：遍历目录的文件、解析 id 与 title、搜索匹配指南 index 文件、替换或者追加。

1、遍历指定目录【\_post 目录】中的所有 markdown 文件，对每个文件执行2。

2、对单个文件，使用 **grep** 正则搜索： **'^id: [0-9]{10}'**，使用 **awk** 获取 id 值，判断 id 值是否在 index 文件中，在则跳过，否则执行3。

3、再使用 **grep** 正则搜索： **'^title: **，使用 **awk** 获取 title 值，执行4，把 id 值和 title 值追加到 index 文件中。

4、先使用 **grep id 值 index 文件**搜索3中的 id 是否已经在 index 文件中，不在才能追加进去。追加 index 文件时，先重命名 index 文件为 index-bak，逐行读取。对每一行数据使用 **grep** 正则搜索： **'^- [0-9]{10}，'**，如果搜索无内容的直接将当前行写入新文件，命名为 index。再结合使用 **awk** 获取当前行的 id 值，只要3中的 id 值大于此 id 值并且年份一致，则将3中的 id 值和 title 值写入新文件【构造特定格式的数据行】，接着再将当前行写入新文件。如果年份一致且3中的 id 值最小，则按照5写入当年的数据最后一行。

5、相同年份作一个标记，是否已经写入新文件作一个标记，如果遇到读取的下一行已经不是当年的数据【正则搜索无结果】，则把构造的特定格式的数据行写入新文件，再把当前行写入新文件。

6、4中的文件逐行读取完成后，把4中一开始重命名的文件 index-bak 删除，只保留新文件 index，此时 index 文件中已经增加了一行新内容。


# 具体实现


由于实现思路简化了，所以要求 index 文件在每一年都至少已经有一个完整的记录，否则没法对比写入。

待实现。

