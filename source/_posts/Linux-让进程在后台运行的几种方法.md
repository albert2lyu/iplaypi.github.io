---
title: Linux 让进程在后台运行的几种方法
id: 2019051501
date: 2019-05-15 15:49:53
updated: 2019-06-08 15:49:53
categories: 大数据技术知识
tags: [Linux,nohup,setsid,disown,screen,daemon]
keywords: Linux,nohup,setsid,disown,screen,daemon
---


在 `Linux` 系统中，运行程序时经常需要把进程放在后台运行，并且退出终端等待，也可以说是守护进程，`daemon` 的概念，可能过几个小时或者十几个小时之后再去观察。此时，需要把进程放入后台运行，并且为了防止进程挂起，也需要设置进程忽略挂起信号【使用 `nohup` 命令】，这样就可以保证进程在我退出终端后仍旧能正常运行，无论我多久之后再来观察，仍可以看到进程的信息。本文记录关于进程后台运行【daemon】的几种方法，并给出实际操作示例。


<!-- more -->


# 回顾


在我刚开始步入工作的路途上，算是一个职场新手，很多东西都不会，一路上披荆斩棘，现在总算积累了一些经验。记得在刚开始工作时，经常碰到这样的问题，使用 `telnet` 或者 `ssh` 登录了远程的 `Linux` 服务器【很多工作需要在 `Linux` 上面完成】，在上面跑了几个 `Shell` 脚本，或者起了几个 `Java` 进程，而且这些脚本或者进程耗时都比较长，可能需要几个小时或者几天。我一开始的做法就是打开 `XShell` 工具的多个会话，分别跑脚本或者起进程，不仅不能关掉，而且还要担心网络问题导致会话断开，一切工作就白费了。

结果被其他同事看到了，说我这种做法太蠢了，可以使用后台挂起的命令【即 `nohup` 加上 `&`】，这样就可以让进程自由在在地运行，我也可以安心做其它事情了。我第一次受到了经验方面的冲击，觉得这种方式太酷了，一开始我为什么不多思考一下或者查询一下，我想这些实用的知识点肯定还有很多，从此以后我更加努力。

在后来的工作或者生活当中，我又接触到了很多类似的知识点或者说是小技巧，不仅提高了我的工作效率，还丰富了我的认知。其中，基于进程的后台运行这个需求，还有很多很好的工具可以使用，还有很多实际操作的小技巧可以使用，以下篇幅会一一介绍。继续阅读之前，可以先了解一下信号的概念，也可以直接参考我的另外一篇博文：[Linux 之 kill 命令入门实践](https://www.playpi.org/2019042101.html) 。


# 前言


在工程师或者运维人员的生涯中，肯定会碰到这样的场景：使用 `ssh` 或者 `telnet` 登录了远程服务器，然后在上面跑一些任务或者脚本。如果是临时任务或者几分钟就能搞定的任务，基本不会有什么问题，但是如果是耗时比较长的任务，就会因为网络不稳定或者手抖退出了会话，从而导致任务失败，还要从头再来，遇到这种问题所有人都是崩溃的。

那么我不禁思考，有没有什么办法可以让任务在提交后不受网络中断、会话退出的影响呢，可以一直保持在后台稳定运行，直到结束。肯定是有的，读者在工作中一定也见过周围的大神同事操作，下面列举一些常用的方式，读者可以参考，选择自己喜欢的方式使用。


# 直接忽略挂起信号


众所周知，当发生用户注销会话、网络断开等事件时，终端会收到 `SIGHUP` 信号从而关闭其所有的子进程【通过把 `SIGHUP` 信号发送给所有**后台**子进程实现，**前台**子进程直接停掉】。到这里，我就能想到两种解决方案：一是让进程忽略掉 `SIGHUP` 信号，二是让进程独立运行，附属于其它进程，脱离当前终端对应的进程，这两种方法都可以让进程不受外界因素影响，稳定地运行。

## nohup 方式

思路有了，首先能想到的就是 `nohup` 工具，顾名思义，`nohup` 这个工具的作用就是让进程忽略掉 `SIGHUP` 信号。

先来看一下帮助文档信息，使用 `` 命令查看：

```
待整理
```

图。。

## setsid 方式

待整理。

## & 方式

待整理。


# 忽略挂起的后悔药


后台运行的例子，使用 `disown` 也可以达到效果。

使用 `Ctrl + z` 命令，把正在前台运行的进程暂停，并放在后台，程序并没有被杀死。其实这个组合快捷键是一种控制信号，编号为`19`，标识为 `SIGSTOP`，读者可以参考我的另外一篇博文：[Linux 之 kill 命令入门实践](https://playpi.org/2019042101.html) 。当然，如果使用终端工具，再开一个会话窗口，使用 `ps` 命令查询这个进程的 `pid` 编号，然后使用 `kill -19 pid` 命令发送一个 `SIGSTOP` 信号给进程也可以达到把程序暂停并放在后台的效果。


# 批量管理


前面的描述都是单个进程或者几个进程，管理起来也挺方便，但是如果遇到大量的进程需要管理，例如运维人员日常需要手动管理大量的进程，几百个几千个都是有可能的，那么怎么办呢。为了简化管理，并且保证进程能在后台稳定运行，此时就需要通过 `screen` 工具来操作，这是一个利器。

首先我们来看一下帮助文档信息，使用 `man screen` 命令输出：

```
xx
```

图。。


# 备注


1、关于挂起的测试

我使用 `XShell` 测试退出终端时，发现并不会挂起普通的后台进程【说明后台进程没有接收到 `SIGHUP` 信号】，反而把进程的父进程设置为了 `init`【进程号为1】，这样进程就不会退出，下次登录的时候还能查看。但是这个现象违反了前面的知识点：退出终端时所有子进程会收到 `SIGHUP` 信号，后来我发现，原来这个操作是针对**前台任务**而言的，如果是**后台任务**则不一定，要看系统的参数设置：`shopt | grep huponexit`，`huponexit` 这个参数决定了是否向后台任务发送 `SIGHUP` 信号。而在大多数 `Linux` 系统中，这个参数一般默认是关闭的，所以才出现了终端退出后台进程没有挂起的现象。

2、读者可以继续探索一下 `tmux` 工具的使用，这类工具可以更加高效、安全地帮助我们管理后台进程，从而让我们脱离手动管理后台程序的苦海。

