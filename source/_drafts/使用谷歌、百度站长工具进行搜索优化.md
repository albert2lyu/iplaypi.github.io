---
title: 使用谷歌、百度站长工具进行搜索优化
id: 2019-07-30 00:40:37
date: 2019-07-30 00:40:37
updated: 2019-07-30 00:40:37
categories:
tags:
keywords:
---
优化待整理
<!-- more -->


2018年
建站
seo,SEO,Google,Baidu,SHell,Hexo,travis

为了提高提交链接的频率，把**自动提交**中的**主动推送**方法也用起来，作为工程师，肯定不会手动去整理 url 文件然后提交，而是要使用自动化的方式。

其实我的方案也很简单，使用 Shell 脚本，自动收集 url 追加到指定的文件，然后在 travis 的自动构件脚本中添加百度站长提供的 curl 命令进行**主动推送**。为了防止秘钥泄露，在构建脚本中使用秘钥变量，把秘钥的值保存在 travis 系统中。

我的 Shell 脚本为 `auto_collect_urls.sh`，内容如下：

```
#!/bin/bash
# urls 文件 
urls=./baidu_urls.txt
# url 格式 
content_pattern='https://www.playpi.org/id.html'
# 遍历文件夹内的所有文件 
for file in ./source/_posts/*.md
do
  if [ -f $file ]; then
    # 获取单个文件的 id【在第 3 行】
    echo '================================================================'
    # echo '====read file:' $file
    var1=$(grep -nE '^id: [0-9]{10}' $file | grep -E '^3:id: [0-9]{10}' | awk -F': ' '{print $2;}')
    # echo '====read id:' $var1
    # 判断非空必须使用双引号，否则逻辑错误 
    if [ -n "$var1" ]; then
      has=$(grep $var1 $urls)
      # 为空，表示 id 不在 urls 文件中，has 变量切记使用双引号 
      if [ -z "$has" ]; then
        # 字符串搜索替换，待搜索字符串是变量，不是字符串本身，// 表示替换所有 
        content=${content_pattern//id/$var1}
        # 追加到 urls 文件中 
        echo '====prepare append to urls:' $content
        echo $content >> $urls
      else
      # 在 urls 文件中已经存在，无需处理 
      echo '====urls has:' $var1
      fi
    else
    echo '!!!!invalid var:' $var1
    fi
  else
  echo '!!!!invalid file:' $file
  fi
done
```

生成的 url 集合文件为 `baidu_urls.txt`，紧接着，在 `travis` 的构建脚本中添加如下内容【注意要在能识别 Linux 命令的位置添加】：

```
before_install:
...
# 主动推送 urls 到百度站长
- echo 'start push urls to baidu'
- curl -H 'Content-Type:text/plain' --data-binary @${URLS_FILE} "http://data.zz.baidu.com/urls?site=https://www.playpi.org&token=${BAIDU_TOKEN}"

```

其中，`URLS_FILE`、`BAIDU_TOKEN` 这两个变量需要在 `travis` 中设置。

